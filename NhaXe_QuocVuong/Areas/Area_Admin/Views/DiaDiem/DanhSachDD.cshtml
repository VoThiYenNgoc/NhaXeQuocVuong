@model IEnumerable<NhaXe_QuocVuong.Models.DiaDiem>

@{ ViewBag.Title = "Quản Lý Địa Điểm";
                Layout = "~/Areas/Area_Admin/Views/Shared/LayoutAdmin.cshtml"; }
<head>
    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body {
            background-color: #f8f9fa;
        }

        .table {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-family: 'Arial', sans-serif;
            font-weight: bold;
        }

        .btn {
            margin-right: 5px;
        }

        .action-link {
            margin-right: 5px;
        }

        .btn-custom {
            padding: 5px 10px;
        }
    </style>
</head>

<div class="container mt-4">
    <h1 class="text-center mb-4" style="font-size: 45px; color:red;">QUẢN LÝ ĐỊA ĐIỂM</h1>
    <div class="text-right mb-3">
        @Html.ActionLink("Thêm Địa Điểm Mới", "ThemDD", null, new { @class = "btn btn-success btn-lg" })
    </div>
    <form method="get">
        <input type="text" name="search" placeholder="Tìm kiếm địa điểm..." />
        <input type="submit" value="Tìm kiếm" />
    </form>
    <table class="table table-striped table-bordered">
        <thead class="table-light">
            <tr>
                <th><input type="checkbox" id="checkAll" /> Chọn Tất Cả</th>
                <th>Tên Địa Điểm</th>
                <th class="text-center">Thao Tác</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
<tr>
    <td>
        <input type="checkbox" class="diaDiemCheckbox" value="@item.ID_DIADIEM" />
    </td>
    <td>@Html.DisplayFor(modelItem => item.TEN_TINH_THANH)</td>
    <td class="text-center">
        @Html.ActionLink("Cập Nhật", "CapNhatDD", new { id = item.ID_DIADIEM }, new { @class = "btn btn-warning btn-sm action-link btn-custom" })
        <button type="button" class="btn btn-danger btn-sm action-link btn-custom delete-btn" data-id="@item.ID_DIADIEM">Xóa</button>
    </td>
</tr>            }
        </tbody>
    </table>
</div>

<script>
    // Chức năng xóa nhiều địa điểm
    document.querySelectorAll(".delete-btn").forEach(button => {
        button.addEventListener("click", function () {
            var id = this.getAttribute("data-id");

            Swal.fire({
                title: 'Bạn có chắc chắn muốn xóa?',
                text: "Hành động này không thể hoàn tác!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Xóa',
                cancelButtonText: 'Hủy'
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire({
                        title: 'Đang xóa...',
                        allowOutsideClick: false,
                        didOpen: () => Swal.showLoading()
                    });

                    // Gửi yêu cầu xóa đến controller với ID đã chọn
                    fetch(`/Area_Admin/DiaDiem/XoaDD`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify([id])
                    })
                        .then(response => {
                            if (!response.ok) throw new Error('Không thể xóa địa điểm.');

                            return response.json();
                        })
                        .then(data => {
                            Swal.fire('Đã xóa!', data.message || 'Địa điểm đã được xóa thành công.', 'success')
                                .then(() => location.reload());
                        })
                        .catch(err => {
                            Swal.fire('Có lỗi xảy ra!', err.message || 'Không thể kết nối đến server.', 'error');
                        });
                }
            });
        });
    });

    // Chọn tất cả checkbox
    document.getElementById("checkAll").addEventListener("change", function () {
        var checkboxes = document.querySelectorAll(".diaDiemCheckbox");
        checkboxes.forEach(function (checkbox) {
            checkbox.checked = this.checked;
        }, this);
    });

    // Hiển thị thông báo từ server nếu có
    $(document).ready(function() {
        @if (ViewBag.Message != null)
        {
            <text>
                Swal.fire({
                    icon: 'success',
                    title: 'Thành công!',
                    text: '@ViewBag.Message',
                    confirmButtonText: 'Đóng'
                });
            </text>
        }
    });
</script>